#include "watch.h"static int key3_state=0;void  Handler(int signo){    //System Exit    printf("\r\nHandler:Goto Sleep mode\r\n");    EPD_Sleep();    DEV_ModuleExit();    exit(0);}int watch_init(watch_t *pstWatch){	bzero(pstWatch,sizeof(watch_t));	return 0;}void * key0_first_press_down(void *p_parameter){    printf("key1_first_press_down\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_phone.bmp" , PRIORITY_1, PICTURE);}void * key0_short_press(void *p_parameter){    printf("key0_short_press, para:%s\n", (char *)p_parameter);}void * key0_long_press(void *p_parameter){    printf("key0_long_press\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_phone.bmp" , PRIORITY_1, PICTURE);	watch_asr_t stWatchAsr;	asr_init(&stWatchAsr);	asr_server(&stWatchAsr);	watch_phone_call(stWatchAsr.cszVtoT);	return 0;}void * key0_up(void *p_parameter){    printf("key0_up\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_1, PICTURE);}void * key1_first_press_down(void *p_parameter){    printf("key1_first_press_down\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_mesg.bmp" , PRIORITY_1, PICTURE);}void * key1_short_press(void *p_parameter){    printf("key1_short_press, para:%s\n", (char *)p_parameter);}void * key1_long_press(void *p_parameter){    printf("key1_long_press\n");		char cszSpeakContent[256]={0};		enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_mesg.bmp" , PRIORITY_1, PICTURE);		watch_t *pstWatch = (watch_t *)p_parameter;	watch_asr_t stWatchAsr;	asr_init(&stWatchAsr);	asr_server(&stWatchAsr);			if(pstWatch->stWatchMesg.iState == MESG_CONTENT){		strncpy(pstWatch->stWatchMesg.cszMesg,stWatchAsr.cszVtoT,strlen(stWatchAsr.cszVtoT));				charset_convert("UTF-8","GB2312",stWatchAsr.cszVtoT,strlen(stWatchAsr.cszVtoT),cszSpeakContent,256);		enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);		enqueue_display(20 ,20,PART_REFRESH,cszSpeakContent, PRIORITY_3, TEXT_CHINESE);		enqueue_display(0 ,0 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);				pstWatch->stWatchMesg.iState = MESG_NAME;		printf("speak name!!!!\n");	}else if(pstWatch->stWatchMesg.iState == MESG_NAME){		strncpy(pstWatch->stWatchMesg.cszName,stWatchAsr.cszVtoT,strlen(stWatchAsr.cszVtoT));		watch_mesg_send(&pstWatch->stWatchMesg);		pstWatch->stWatchMesg.iState = MESG_CONTENT;		printf("speak content!!!!\n");	}	return 0;}void * key1_up(void *p_parameter){	printf("1111111111111111111111\n");    enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_1, PICTURE);  return 0;}void * key2_first_press_down(void *p_parameter){    printf("key2_first_press_down\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_home.bmp" , PRIORITY_1, PICTURE);}void * key2_short_press(void *p_parameter){    printf("key2_short_press, para:%s\n", (char *)p_parameter);}static int show_weather(char * pcWeather,char *pcCity1,char *pcCity2,char *pcTem){		char cszTem[5]={0};		char cszCity1[5]={0};		char cszCity2[5]={0};		charset_convert("UTF-8","GB2312",pcTem,strlen("pcTem"),cszTem,5);		charset_convert("UTF-8","GB2312",pcCity1,strlen("pcTem"),cszCity1,5);		charset_convert("UTF-8","GB2312",pcCity2,strlen("pcTem"),cszCity2,5);		if(!strcmp("æ™´",pcWeather)){			printf("1111111111111111\n");			enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing_white.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);						enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(133 ,10 ,PART_REFRESH,cszCity1, PRIORITY_3, TEXT_CHINESE);			enqueue_display(133 ,25 ,PART_REFRESH,cszCity2 , PRIORITY_3, TEXT_CHINESE);			enqueue_display(225, 45 ,PART_REFRESH,cszTem , PRIORITY_3, TEXT_CHINESE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);		}else if(!strcmp("é˜´",pcWeather)){			enqueue_display(130 ,5 ,PART_REFRESH,"./pic/yin_white.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);						enqueue_display(130 ,5 ,PART_REFRESH,"./pic/yin.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(133 ,10 ,PART_REFRESH,cszCity1, PRIORITY_3, TEXT_CHINESE);			enqueue_display(133 ,25 ,PART_REFRESH,cszCity2, PRIORITY_3, TEXT_CHINESE);			enqueue_display(225, 45 ,PART_REFRESH,cszTem , PRIORITY_3, TEXT_CHINESE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);				}else if(!strcmp("å¤šäº‘",pcWeather)){			enqueue_display(130 ,5 ,PART_REFRESH,"./pic/duoyun_white.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);						enqueue_display(130 ,5 ,PART_REFRESH,"./pic/duoyun.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(133 ,10 ,PART_REFRESH,cszCity1, PRIORITY_3, TEXT_CHINESE);			enqueue_display(133 ,25 ,PART_REFRESH,cszCity2, PRIORITY_3, TEXT_CHINESE);			enqueue_display(225, 45 ,PART_REFRESH,cszTem , PRIORITY_3, TEXT_CHINESE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);		}else{			enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing_white.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);						enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(133 ,10 ,PART_REFRESH,cszCity1, PRIORITY_3, TEXT_CHINESE);			enqueue_display(133 ,25 ,PART_REFRESH,cszCity2, PRIORITY_3, TEXT_CHINESE);			enqueue_display(225, 45 ,PART_REFRESH,cszTem , PRIORITY_3, TEXT_CHINESE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);		}				return 0;		}void * key2_long_press(void *p_parameter){    printf("key2_long_press\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_home.bmp" , PRIORITY_1, PICTURE);		watch_asr_t stWatchAsr;	watch_weather_t stWatchWeather;	asr_init(&stWatchAsr);	asr_server(&stWatchAsr);	weather_init(&stWatchWeather);	weather_server(&stWatchWeather,stWatchAsr.cszVtoT);		if(!strcmp("åŒ—äº¬",stWatchAsr.cszVtoT)){		show_weather(stWatchWeather.stWeather.cszText,"åŒ—","äº¬",stWatchWeather.stWeather.cszTem);	}else if(!strcmp("ä¸Šæµ·",stWatchAsr.cszVtoT)){		show_weather(stWatchWeather.stWeather.cszText,"ä¸Š","æµ·",stWatchWeather.stWeather.cszTem);	}else if(!strcmp("æ·±åœ³",stWatchAsr.cszVtoT)){		show_weather(stWatchWeather.stWeather.cszText,"æ·±","åœ³",stWatchWeather.stWeather.cszTem);	}else if(!strcmp("å…°å·ž",stWatchAsr.cszVtoT)){		show_weather(stWatchWeather.stWeather.cszText,"å…°","å·ž",stWatchWeather.stWeather.cszTem);	}else{		show_weather(stWatchWeather.stWeather.cszText,"åŒ—","äº¬",stWatchWeather.stWeather.cszTem);	}	return 0;}void * key2_up(void *p_parameter){	printf("key2_up\n");    enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_1, PICTURE);  return 0;}void * key3_first_press_down(void *p_parameter){    printf("key3_first_press_down\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_AI.bmp" , PRIORITY_1, PICTURE);}void * key3_short_press(void *p_parameter){    printf("key3_short_press\n");	watch_t *pstWatch =(watch_t *) p_parameter;		key3_state = 1;		key3_second(pstWatch);		#if 1	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/dack.bmp" , PRIORITY_4, PICTURE);	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/white.bmp" , PRIORITY_4, PICTURE);	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AIworld.bmp" , PRIORITY_4, PICTURE);	#endif	}void * key3_long_press(void *p_parameter){    printf("key3_long_press\n");		enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_AI.bmp" , PRIORITY_1, PICTURE);				enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing_white.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);						enqueue_display(130 ,5 ,PART_REFRESH,"./pic/qing.bmp" , PRIORITY_3, PICTURE);			enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_3, PICTURE);			enqueue_display(133 ,10 ,PART_REFRESH,"±±", PRIORITY_3, TEXT_CHINESE);			enqueue_display(133 ,25 ,PART_REFRESH,"¾©", PRIORITY_3, TEXT_CHINESE);			enqueue_display(225, 45 ,PART_REFRESH,"25" , PRIORITY_3, TEXT_CHINESE);			enqueue_display(130 ,5 ,PART_REFRESH,"end" , PRIORITY_3, PICTURE);}void * key3_up(void *p_parameter){    printf("key3_up\n");	enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_1, PICTURE);}int keyall_first(watch_t *pstWatch){	#if 1	key_sys_register(KEY0_FIRST_PRESS_DOWN,key0_first_press_down,pstWatch);	key_sys_register(KEY0_SHORT_PRESS,key0_short_press,pstWatch);	key_sys_register(KEY0_LONG_PRESS,key0_long_press,pstWatch);	key_sys_register(KEY0_UP,key0_up,pstWatch);	key_sys_register(KEY1_FIRST_PRESS_DOWN,key1_first_press_down,pstWatch);	key_sys_register(KEY1_SHORT_PRESS,key1_short_press,pstWatch);	key_sys_register(KEY1_LONG_PRESS,key1_long_press,pstWatch);    key_sys_register(KEY1_UP,key1_up,pstWatch);	key_sys_register(KEY2_FIRST_PRESS_DOWN,key2_first_press_down,pstWatch);	key_sys_register(KEY2_SHORT_PRESS,key2_short_press,pstWatch);	key_sys_register(KEY2_LONG_PRESS,key2_long_press,pstWatch);    key_sys_register(KEY2_UP,key2_up,pstWatch);	key_sys_register(KEY3_FIRST_PRESS_DOWN,key3_first_press_down,pstWatch);	key_sys_register(KEY3_SHORT_PRESS,key3_short_press,pstWatch);	key_sys_register(KEY3_LONG_PRESS,key3_long_press,pstWatch);	key_sys_register(KEY3_UP,key3_up,pstWatch);#endif		return 0;}//key3çŸ­æŒ‰åŽçš„äºŒçº§ç•Œé¢çš„æŒ‰é”®å›¾ç‰‡åˆ‡æ¢é€»è¾‘void * key30_first_press_down(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_food.bmp" , PRIORITY_4, PICTURE);}void * key30_short_press(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_happy.bmp" , PRIORITY_4, PICTURE);	}void * key30_long_press(void *p_parameter){	}void * key30_up(void *p_parameter){}void * key31_first_press_down(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_water.bmp" , PRIORITY_4, PICTURE);	}void * key31_short_press(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_happy.bmp" , PRIORITY_4, PICTURE);	}void * key31_long_press(void *p_parameter){	}void * key31_up(void *p_parameter){	}void * key32_first_press_down(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_back.bmp" , PRIORITY_4, PICTURE);	}void * key32_short_press(void *p_parameter){	watch_t *pstWatch =(watch_t *) p_parameter;	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/dack.bmp" , PRIORITY_4, PICTURE);	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/white.bmp" , PRIORITY_4, PICTURE);	enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);	key3_state=0;	keyall_first(pstWatch);}void * key32_long_press(void *p_parameter){	}void * key32_up(void *p_parameter){}void * key33_first_press_down(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_chat.bmp" , PRIORITY_4, PICTURE);	}void * key33_short_press(void *p_parameter){	enqueue_display(0 ,0 ,PART_REFRESH,"./pic/AI_world/AI_happy.bmp" , PRIORITY_4, PICTURE);	}void * key33_long_press(void *p_parameter){	}void * key33_up(void *p_parameter){	}int key3_second(watch_t *pstWatch){		key_sys_register(KEY0_FIRST_PRESS_DOWN,key30_first_press_down,pstWatch);	key_sys_register(KEY0_SHORT_PRESS,key30_short_press,pstWatch);	key_sys_register(KEY0_LONG_PRESS,key30_long_press,pstWatch);	key_sys_register(KEY0_UP,key30_up,pstWatch);	key_sys_register(KEY1_FIRST_PRESS_DOWN,key31_first_press_down,pstWatch);	key_sys_register(KEY1_SHORT_PRESS,key31_short_press,pstWatch);	key_sys_register(KEY1_LONG_PRESS,key31_long_press,pstWatch);    key_sys_register(KEY1_UP,key31_up,pstWatch);	key_sys_register(KEY2_FIRST_PRESS_DOWN,key32_first_press_down,pstWatch);	key_sys_register(KEY2_SHORT_PRESS,key32_short_press,pstWatch);	key_sys_register(KEY2_LONG_PRESS,key32_long_press,pstWatch);    key_sys_register(KEY2_UP,key32_up,pstWatch);	key_sys_register(KEY3_FIRST_PRESS_DOWN,key33_first_press_down,pstWatch);	key_sys_register(KEY3_SHORT_PRESS,key33_short_press,pstWatch);	key_sys_register(KEY3_LONG_PRESS,key33_long_press,pstWatch);	key_sys_register(KEY3_UP,key33_up,pstWatch);	return 0;}void *watch_time(void *pvArgs){	watchTime_t stWatchTime;	watch_currenttime(&stWatchTime);	while(1){		char cszTimeNow[20]={0};		char cszTimeNow_GB[20]={0};						sleep(1);						stWatchTime.iSec++;		if(stWatchTime.iSec>=60){			stWatchTime.iMin++;			stWatchTime.iSec=0;			sprintf(cszTimeNow,"%d:%d",stWatchTime.iHour,stWatchTime.iMin);			if(key3_state==0){				charset_convert("UTF-8","GB2312",cszTimeNow,strlen(cszTimeNow),cszTimeNow_GB,20);					enqueue_display(20, 20 ,PART_REFRESH,cszTimeNow_GB, PRIORITY_2, TEXT_ENGLISH);			}			printf("!!!!!!!!\n");					}				if(stWatchTime.iMin>=60){			stWatchTime.iHour++;			stWatchTime.iMin=0;						watch_currenttime(&stWatchTime);		}					printf("%d-%d-%d,%d-%d-%d\n",stWatchTime.iYear,stWatchTime.iMounth,stWatchTime.iDay,stWatchTime.iHour,stWatchTime.iMin,stWatchTime.iSec);	}	}int show_standby(int iNum){	switch(iNum){		case 0:			enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);			break;		case 1:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_1.bmp" , PRIORITY_4, PICTURE);			break;		case 2:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_2.bmp" , PRIORITY_4, PICTURE);			break;		case 3:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_3.bmp" , PRIORITY_4, PICTURE);			break;		default:			break;	}	return 0;}int g_Num = 0;void *watch_rotate_cw(void *pvArgs){#if 0	int *pNum =(int *) pvArgs;	if(*pNum<3){		*pNum ++;	}	show_standby(*pNum);		printf("********lllllllllllllllll****%d\n",*pNum);#endif	if(g_Num<3){		g_Num++;	}	show_standby(g_Num);	printf("********lllllllllllllllll****%d\n",g_Num);}void *watch_rotate_ccw(void *pvArgs){#if 0	int *pNum =(int *) pvArgs;	if(*pNum>0){		*pNum --;	}	show_standby(*pNum);	printf("********dddddddddddddddddd****%d\n",*pNum);#endif		if(g_Num>0){		g_Num--;	}	show_standby(g_Num);	printf("********dddddddddddddddddd****%d\n",g_Num);}int watch_exec(watch_t *pstWatch){		pthread_t stTid;			key_module_init();	display_module_init();		alps_rotate_module_init();			keyall_first(pstWatch);		pthread_create(&stTid,NULL,watch_time,NULL);	enqueue_display(0 ,64, FULL_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);			int iNum = 0;	alps_sys_register(2,watch_rotate_cw,&iNum,CW);	alps_sys_register(2,watch_rotate_ccw,&iNum,CCW);	while(1){		sleep(1);	}}