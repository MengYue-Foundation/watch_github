#include "watch.h"static int key3_state=0;int g_iWhich_screen;pthread_cond_t stCond_key_init;pthread_mutex_t stMutex_key_init;void  Handler(int signo){    //System Exit    printf("\r\nHandler:Goto Sleep mode\r\n");    EPD_Sleep();    DEV_ModuleExit();    exit(0);}int watch_init(watch_t *pstWatch){	bzero(pstWatch,sizeof(watch_t));	return 0;}void * keyall_first(void *pvArgs){#if 1	pthread_mutex_init(&stMutex_key_init, NULL);	pthread_cond_init(&stCond_key_init, NULL);		while(1){		g_iWhich_screen = 1000;		//key_sys_register(KEY0_FIRST_PRESS_DOWN,phone_first_press_down,NULL);		//key_sys_register(KEY0_SHORT_PRESS,phone_short_press,NULL);		//key_sys_register(KEY0_LONG_PRESS,phone_long_press,NULL);		//key_sys_register(KEY0_UP,phone_up,NULL);		key_sys_register(KEY1_FIRST_PRESS_DOWN,lark_first_press_down,NULL);		key_sys_register(KEY1_SHORT_PRESS,lark_short_press,&g_iWhich_screen);		key_sys_register(KEY1_LONG_PRESS,lark_long_press,NULL);		key_sys_register(KEY1_UP,lark_up,NULL);		key_sys_register(KEY2_FIRST_PRESS_DOWN,remind_first_press_down,NULL);		key_sys_register(KEY2_SHORT_PRESS,remind_short_press,NULL);		key_sys_register(KEY2_LONG_PRESS,remind_long_press,NULL);		key_sys_register(KEY2_UP,remind_up,NULL);		key_sys_register(KEY3_FIRST_PRESS_DOWN,aiworld_first_press_down,NULL);		key_sys_register(KEY3_SHORT_PRESS,aiworld_short_press,NULL);		key_sys_register(KEY3_LONG_PRESS,aiworld_long_press,NULL);		key_sys_register(KEY3_UP,aiworld_up,NULL);				enqueue_display(0 ,0 ,PART_REFRESH,"./pic/dack.bmp" , PRIORITY_4, PICTURE);		enqueue_display(0 ,0 ,PART_REFRESH,"./pic/white.bmp" , PRIORITY_4, PICTURE);		enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);				pthread_mutex_lock(&stMutex_key_init);		pthread_cond_wait(&stCond_key_init, &stMutex_key_init); 		pthread_mutex_unlock(&stMutex_key_init);			}#endif	}void *watch_time(void *pvArgs){	watchTime_t stWatchTime;	watch_currenttime(&stWatchTime);	while(1){		char cszTimeNow[20]={0};		char cszTimeNow_GB[20]={0};						sleep(1);						stWatchTime.iSec++;		if(stWatchTime.iSec>=60){			stWatchTime.iMin++;			stWatchTime.iSec=0;			sprintf(cszTimeNow,"%d:%d",stWatchTime.iHour,stWatchTime.iMin);			if(g_iWhich_screen==1000){				charset_convert("UTF-8","GB2312",cszTimeNow,strlen(cszTimeNow),cszTimeNow_GB,20);					enqueue_display(20, 20 ,PART_REFRESH,cszTimeNow_GB, PRIORITY_2, TEXT_ENGLISH);			}else if(g_iWhich_screen == 1200){				charset_convert("UTF-8","GB2312",cszTimeNow,strlen(cszTimeNow),cszTimeNow_GB,20);					enqueue_display(150, 104 ,PART_REFRESH,cszTimeNow_GB, PRIORITY_2, TEXT_ENGLISH);				}			printf("!!!!!!!!\n");					}				if(stWatchTime.iMin>=60){			stWatchTime.iHour++;			stWatchTime.iMin=0;						watch_currenttime(&stWatchTime);		}					printf("%d-%d-%d,%d-%d-%d\n",stWatchTime.iYear,stWatchTime.iMounth,stWatchTime.iDay,stWatchTime.iHour,stWatchTime.iMin,stWatchTime.iSec);	}	}int show_standby(int iNum){	switch(iNum){		case 0:			enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);			break;		case 1:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_1.bmp" , PRIORITY_4, PICTURE);			break;		case 2:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_2.bmp" , PRIORITY_4, PICTURE);			break;		case 3:			enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_3.bmp" , PRIORITY_4, PICTURE);			break;		default:			break;	}	return 0;}int g_Num = 0;void *watch_rotate_cw(void *pvArgs){#if 0	int *pNum =(int *) pvArgs;	if(*pNum<3){		*pNum ++;	}	show_standby(*pNum);		printf("********lllllllllllllllll****%d\n",*pNum);#endif	if(g_Num<3){		g_Num++;	}	show_standby(g_Num);	printf("********lllllllllllllllll****%d\n",g_Num);}void *watch_rotate_ccw(void *pvArgs){#if 0	int *pNum =(int *) pvArgs;	if(*pNum>0){		*pNum --;	}	show_standby(*pNum);	printf("********dddddddddddddddddd****%d\n",*pNum);#endif		if(g_Num>0){		g_Num--;	}	show_standby(g_Num);	printf("********dddddddddddddddddd****%d\n",g_Num);}int watch_exec(watch_t *pstWatch){		pthread_t stTid;	pthread_t stTid_watch_lark;	pthread_t stTid_watch_remind;	pthread_t stTid_init_key;		int iWhich_screen = 1000;		g_iWhich_screen = iWhich_screen;		key_module_init();	display_module_init();		taptic_engine_module_init();		//alps_rotate_module_init();			pthread_create(&stTid,NULL,watch_time,&iWhich_screen);		pthread_create(&stTid_init_key,NULL,keyall_first,NULL);	enqueue_display(0 ,64, FULL_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);		//enqueue_display(20, 40 ,PART_REFRESH,"高gggg123也", PRIORITY_2, TEXT_CHINESE);		int iNum = 0;	//alps_sys_register(2,watch_rotate_cw,&iNum,CW);	//alps_sys_register(2,watch_rotate_ccw,&iNum,CCW);			pthread_create(&stTid_watch_lark,NULL,watch_lark_client,&g_iWhich_screen);		pthread_create(&stTid_watch_remind,NULL,watch_remind,&g_iWhich_screen);	while(1){		sleep(1);	}}