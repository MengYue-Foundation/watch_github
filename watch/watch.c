#include "watch.h"static int key3_state=0;int g_iWhich_screen;int g_iNum;int g_iRotate;int g_iNumBuf;pthread_cond_t stCond_key_init;pthread_mutex_t stMutex_key_init;void  Handler(int signo){    //System Exit    printf("\r\nHandler:Goto Sleep mode\r\n");    EPD_Sleep();    DEV_ModuleExit();    exit(0);}int watch_init(watch_t *pstWatch){	bzero(pstWatch,sizeof(watch_t));	return 0;}int watch_rotate_showpress(void){		switch(g_iNum){		case 0:			if(g_iNumBuf == 0){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_phone.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 1){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_mesg.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 2){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_home.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 3){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/standby_AI.bmp" , PRIORITY_4, PICTURE);			}			break;		case 1:			if(g_iNumBuf == 0){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_1_mesg.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 1){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_1_home.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 2){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_1_AI.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 3){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_1_lark.bmp" , PRIORITY_4, PICTURE);			}			break;		case 2:			if(g_iNumBuf == 0){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_2_home.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 1){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_2_AI.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 2){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_2_lark.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 3){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_2_text.bmp" , PRIORITY_4, PICTURE);			}			break;		case 3:			if(g_iNumBuf == 0){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_3_AI.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 1){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_3_lark.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 2){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_3_text.bmp" , PRIORITY_4, PICTURE);			}else if(g_iNumBuf == 3){				enqueue_display(0 ,64 ,PART_REFRESH,"./pic/rotate/standby_3_music.bmp" , PRIORITY_4, PICTURE);			}			break;		default:			break;	}	return 0;}void *watch_rotate_cw(void *pvArgs){	#if 0		if(g_iNumBuf < 3){		g_iNumBuf++;		printf("%s,%d,g_iNumBuf=%d",__FUNCTION__,__LINE__,g_iNumBuf);	}				if(g_iNum<3 && g_iNumBuf == 3){		g_iNum++;	}		watch_rotate_showpress();#endif	if(g_iNum < 3){		g_iNum++;	}		g_iRotate = 1;			pthread_mutex_lock(&stMutex_key_init);	pthread_cond_signal(&stCond_key_init); 	pthread_mutex_unlock(&stMutex_key_init);			printf("********lllllllllllllllll****%d\n",g_iNum);}void *watch_rotate_ccw(void *pvArgs){#if 0	if(g_iNumBuf > 0){		g_iNumBuf --;		printf("%s,%d,g_iNumBuf=%d",__FUNCTION__,__LINE__,g_iNumBuf);	}				if(g_iNum>0 && g_iNumBuf == 0){		g_iNum--;	}		watch_rotate_showpress();#endif		if(g_iNum > 0){		g_iNum--;	}	g_iRotate = 1;			pthread_mutex_lock(&stMutex_key_init);	pthread_cond_signal(&stCond_key_init); 	pthread_mutex_unlock(&stMutex_key_init);		printf("********dddddddddddddddddd****%d\n",g_iNum);}void * keyall_first(void *pvArgs){#if 1	pthread_mutex_init(&stMutex_key_init, NULL);	pthread_cond_init(&stCond_key_init, NULL);		while(1){		g_iWhich_screen = 1000;				alps_sys_register(2,watch_rotate_cw,NULL,CW);		alps_sys_register(2,watch_rotate_ccw,NULL,CCW);				if(g_iRotate == 0){			enqueue_display(0 ,0 ,PART_REFRESH,"./pic/dack.bmp" , PRIORITY_4, PICTURE);			enqueue_display(0 ,0 ,PART_REFRESH,"./pic/white.bmp" , PRIORITY_4, PICTURE);		}else{			g_iRotate = 0;		}		switch(g_iNum){			case 0:				screen_1_key();				enqueue_display(0 ,64,PART_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);				break;			case 1:				screen_2_key();				enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_1.bmp" , PRIORITY_4, PICTURE);				break;			case 2:				screen_3_key();				enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_2.bmp" , PRIORITY_4, PICTURE);				break;			case 3:				screen_4_key();				enqueue_display(0 ,64,PART_REFRESH,"./pic/rotate/standby_down_3.bmp" , PRIORITY_4, PICTURE);				break;			default:				break;		}		pthread_mutex_lock(&stMutex_key_init);		pthread_cond_wait(&stCond_key_init, &stMutex_key_init); 		pthread_mutex_unlock(&stMutex_key_init);			}#endif	}void *watch_time(void *pvArgs){	watchTime_t stWatchTime;	watch_currenttime(&stWatchTime);	while(1){		char cszTimeNow[20]={0};		char cszTimeNow_GB[20]={0};						sleep(1);						stWatchTime.iSec++;		if(stWatchTime.iSec>=60){			stWatchTime.iMin++;			stWatchTime.iSec=0;			sprintf(cszTimeNow,"%d:%d",stWatchTime.iHour,stWatchTime.iMin);			if(g_iWhich_screen==1000){				charset_convert("UTF-8","GB2312",cszTimeNow,strlen(cszTimeNow),cszTimeNow_GB,20);					enqueue_display(20, 20 ,PART_REFRESH,cszTimeNow_GB, PRIORITY_2, TEXT_ENGLISH);			}else if(g_iWhich_screen == 1200){				charset_convert("UTF-8","GB2312",cszTimeNow,strlen(cszTimeNow),cszTimeNow_GB,20);					enqueue_display(150, 104 ,PART_REFRESH,cszTimeNow_GB, PRIORITY_2, TEXT_ENGLISH);				}			printf("!!!!!!!!\n");					}				if(stWatchTime.iMin>=60){			stWatchTime.iHour++;			stWatchTime.iMin=0;						watch_currenttime(&stWatchTime);		}					printf("%d-%d-%d,%d-%d-%d\n",stWatchTime.iYear,stWatchTime.iMounth,stWatchTime.iDay,stWatchTime.iHour,stWatchTime.iMin,stWatchTime.iSec);	}	}int watch_exec(watch_t *pstWatch){		pthread_t stTid;	pthread_t stTid_watch_lark;	pthread_t stTid_watch_remind;	pthread_t stTid_init_key;		int iWhich_screen = 1000;		g_iNum = 0;		g_iRotate = 0;		g_iNumBuf = 0;		g_iWhich_screen = iWhich_screen;		key_module_init();	display_module_init();		taptic_engine_module_init();		alps_rotate_module_init();		at_server_module_init();			pthread_create(&stTid,NULL,watch_time,&iWhich_screen);		pthread_create(&stTid_init_key,NULL,keyall_first,NULL);	//enqueue_display(0 ,64, FULL_REFRESH,"./pic/standby_down.bmp" , PRIORITY_4, PICTURE);	//enqueue_display(20, 40 ,PART_REFRESH,"高gggg123也", PRIORITY_2, TEXT_CHINESE);			char cszPhone_receive[32] = {0};		On_Request(REQUEST_RING, phone_receive,(void *)cszPhone_receive);		pthread_create(&stTid_watch_lark,NULL,watch_lark_client,&g_iWhich_screen);		pthread_create(&stTid_watch_remind,NULL,watch_remind,&g_iWhich_screen);	while(1){		sleep(1);	}}